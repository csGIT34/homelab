---
apiVersion: v1
kind: ConfigMap
metadata:
  name: glance-config
  namespace: glance
data:
  glance.yml: |
    # --- Active Theme ---
    theme:
      background-color: 225 14 15
      primary-color: 157 47 65
      contrast-multiplier: 1.1

    # --- Available Themes (uncomment one to switch) ---
    #
    # Teal City (currently active above)
    # theme:
    #   background-color: 225 14 15
    #   primary-color: 157 47 65
    #   contrast-multiplier: 1.1
    #
    # Catppuccin Frappe
    # theme:
    #   background-color: 229 19 23
    #   contrast-multiplier: 1.2
    #   primary-color: 222 74 74
    #   positive-color: 96 44 68
    #   negative-color: 359 68 71
    #
    # Catppuccin Macchiato
    # theme:
    #   background-color: 232 23 18
    #   contrast-multiplier: 1.2
    #   primary-color: 220 83 75
    #   positive-color: 105 48 72
    #   negative-color: 351 74 73
    #
    # Catppuccin Mocha
    # theme:
    #   background-color: 240 21 15
    #   contrast-multiplier: 1.2
    #   primary-color: 217 92 83
    #   positive-color: 115 54 76
    #   negative-color: 347 70 65
    #
    # Camouflage
    # theme:
    #   background-color: 186 21 20
    #   contrast-multiplier: 1.2
    #   primary-color: 97 13 80
    #
    # Gruvbox Dark
    # theme:
    #   background-color: 0 0 16
    #   primary-color: 43 59 81
    #   positive-color: 61 66 44
    #   negative-color: 6 96 59
    #
    # Kanagawa Dark
    # theme:
    #   background-color: 240 13 14
    #   primary-color: 51 33 68
    #   negative-color: 358 100 68
    #   contrast-multiplier: 1.2
    #
    # Tucan
    # theme:
    #   background-color: 50 1 6
    #   primary-color: 24 97 58
    #   negative-color: 209 88 54
    #
    # Dracula
    # theme:
    #   background-color: 231 15 21
    #   primary-color: 265 89 79
    #   contrast-multiplier: 1.2
    #   positive-color: 135 94 66
    #   negative-color: 0 100 67
    #
    # Shades of Purple
    # theme:
    #   background-color: 243 33 25
    #   contrast-multiplier: 1.2
    #   primary-color: 50 100 49
    #   positive-color: 98 82 71
    #   negative-color: 12 77 52
    #
    # Neon Pink
    # theme:
    #   background-color: 240 27 11
    #   contrast-multiplier: 1.5
    #   primary-color: 321 100 71
    #   positive-color: 165 78 51
    #   negative-color: 360 100 71
    #
    # Catppuccin Latte (light)
    # theme:
    #   light: true
    #   background-color: 220 23 95
    #   contrast-multiplier: 1.0
    #   primary-color: 220 91 54
    #   positive-color: 109 58 40
    #   negative-color: 347 87 44
    #
    # Peachy (light)
    # theme:
    #   light: true
    #   background-color: 28 40 77
    #   primary-color: 155 100 20
    #   negative-color: 0 100 60
    #   contrast-multiplier: 1.1
    #   text-saturation-multiplier: 0.5
    #
    # Zebra (light)
    # theme:
    #   light: true
    #   background-color: 0 0 95
    #   primary-color: 0 0 10
    #   negative-color: 0 90 50

    pages:
      - name: Homelab
        columns:
          - size: small
            widgets:
              - type: custom-api
                title: Proxmox-VE Stats
                cache: 1m
                url: ${PROXMOXVE_URL}/api2/json/cluster/resources
                allow-insecure: true
                headers:
                  Accept: application/json
                  Authorization: PVEAPIToken=${PROXMOXVE_KEY}
                template: |
                  <div class="flex flex-column gap-5">
                    <div class="flex justify-between text-center">
                      <div>
                        {{ $nodes_online := len (.JSON.Array "data.#(type==\"node\")#|#(status==\"online\")#") }}
                        {{ $nodes_total := len (.JSON.Array "data.#(type==\"node\")#") }}
                        <div class="color-highlight size-h3">{{ $nodes_online }}/{{ $nodes_total }}</div>
                        <div class="size-h5 uppercase">Node</div>
                      </div>
                      <div>
                        {{ $lxc_running := len (.JSON.Array "data.#(type==\"lxc\")#|#(status==\"running\")#|#(template==0)#") }}
                        {{ $lxc_total := len (.JSON.Array "data.#(type==\"lxc\")#|#(template==0)#") }}
                        <div class="color-highlight size-h3">{{ $lxc_running }}/{{ $lxc_total }}</div>
                        <div class="size-h5 uppercase">LXC</div>
                      </div>
                      <div>
                        {{ $qemu_running := len (.JSON.Array "data.#(type==\"qemu\")#|#(status==\"running\")#|#(template==0)#") }}
                        {{ $qemu_total := len (.JSON.Array "data.#(type==\"qemu\")#|#(template==0)#") }}
                        <div class="color-highlight size-h3">{{ $qemu_running }}/{{ $qemu_total }}</div>
                        <div class="size-h5 uppercase">VM</div>
                      </div>
                      <div>
                        {{ $storage_available := len (.JSON.Array "data.#(type==\"storage\")#|#(status==\"available\")#") }}
                        {{ $storage_total := len (.JSON.Array "data.#(type==\"storage\")#") }}
                        <div class="color-highlight size-h3">{{ $storage_available }}/{{ $storage_total }}</div>
                        <div class="size-h5 uppercase">Storage</div>
                      </div>
                    </div>
                  </div>

              - type: custom-api
                title: Proxmox-VE Nodes
                title-url: https://${PROXMOXVE_URL}
                cache: 1m
                url: ${PROXMOXVE_URL}/api2/json/nodes
                allow-insecure: true
                headers:
                  Accept: application/json
                  Authorization: PVEAPIToken=${PROXMOXVE_KEY}
                options:
                  uptime-mode: duration
                  collapse-after: 5
                template: |
                  {{ $uptimeMode := .Options.StringOr "uptime-mode" "relative" }}
                  {{ $collapseAfter := .Options.IntOr "collapseAfter" 3 }}
                  <ul class="list list-gap-14 collapsible-container" data-collapse-after="{{ $collapseAfter }}">
                    {{ range .JSON.Array "data" }}
                    <li>
                      <div class="server" proxmox-node="{{ .String "node" }}">
                        <div class="server-info">
                          <div class="server-details">
                            <div class="server-name color-highlight size-h3 text-truncate">
                              {{ .String "node" }}
                            </div>
                            <div>
                              {{ if eq $.Response.StatusCode 200 }}
                                <div data-popover-type="html">
                                  <div data-popover-html>
                                    {{ if eq $uptimeMode "relative" }}
                                      <span {{ now.Add (duration (concat "-" (.String "uptime") "s")) | toRelativeTime }}></span>
                                    {{ else }}
                                      <span>{{ duration (concat (.String "uptime") "s") }}</span>
                                    {{ end }}
                                  </div>
                                  <div>
                                    {{ if ne $uptimeMode "relative" }}
                                      <span {{ now.Add (duration (concat "-" (.String "uptime") "s")) | toRelativeTime }}></span>
                                    {{ else }}
                                      <span>{{ duration (concat (.String "uptime") "s") }}</span>
                                    {{ end }}
                                  </div>
                                </div>
                              {{ else }}
                                {{ .String "status" }}
                              {{ end }}
                            </div>
                          </div>
                          <svg class="server-icon" stroke="var(--color-{{ if eq (.String "status") "online" }}positive{{ else }}negative{{ end }})" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M21.75 17.25v-.228a4.5 4.5 0 0 0-.12-1.03l-2.268-9.64a3.375 3.375 0 0 0-3.285-2.602H7.923a3.375 3.375 0 0 0-3.285 2.602l-2.268 9.64a4.5 4.5 0 0 0-.12 1.03v.228m19.5 0a3 3 0 0 1-3 3H5.25a3 3 0 0 1-3-3m19.5 0a3 3 0 0 0-3-3H5.25a3 3 0 0 0-3 3m16.5 0h.008v.008h-.008v-.008Zm-3 0h.008v.008h-.008v-.008Z" />
                          </svg>
                        </div>
                        <div class="server-stats">
                          <div class="flex-1">
                            <div class="flex items-end size-h5">
                              <div>CPU</div>
                              {{ if (ge (mul (.Float "cpu") 100 | toInt ) 80) }}
                              <svg class="server-spicy-cpu-icon" fill="var(--color-negative)" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M8.074.945A4.993 4.993 0 0 0 6 5v.032c.004.6.114 1.176.311 1.709.16.428-.204.91-.61.7a5.023 5.023 0 0 1-1.868-1.677c-.202-.304-.648-.363-.848-.058a6 6 0 1 0 8.017-1.901l-.004-.007a4.98 4.98 0 0 1-2.18-2.574c-.116-.31-.477-.472-.744-.28Zm.78 6.178a3.001 3.001 0 1 1-3.473 4.341c-.205-.365.215-.694.62-.59a4.008 4.008 0 0 0 1.873.03c.288-.065.413-.386.321-.666A3.997 3.997 0 0 1 8 8.999c0-.585.126-1.14.351-1.641a.42.42 0 0 1 .503-.235Z" clip-rule="evenodd" />
                              </svg>
                              {{ end }}
                              <div class="color-highlight margin-left-auto text-very-compact">
                                <span>{{ mul (.Float "cpu") 100 | toInt | formatNumber }}</span> <span class="color-base">%</span>
                              </div>
                            </div>
                            <div data-popover-type="html">
                              <div data-popover-html>
                                <div>
                                  <div class="flex">
                                    <div class="size-h5">LOAD</div>
                                    <div class="value-separator"></div>
                                    <div class="color-highlight text-very-compact"><span>{{ mul (.Float "cpu") 100 | toInt | formatNumber }}</span> <span class="color-base size-h5">%</span></div>
                                  </div>
                                  <div class="flex margin-top-3">
                                    <div class="size-h5">CORES</div>
                                    <div class="value-separator"></div>
                                    <div class="color-highlight text-very-compact">{{ .Int "maxcpu" }}</div>
                                  </div>
                                </div>
                              </div>
                              <div class="progress-bar progress-bar-combined">
                                <div class="progress-value{{ if ge (mul (.Float "cpu") 100 | toInt) 80 }} progress-value-notice{{ end }}" style="--percent: {{ mul (.Float "cpu") 100 | toInt | formatNumber }}"></div>
                              </div>
                            </div>
                          </div>
                          <div class="flex-1">
                            <div class="flex justify-between items-end size-h5">
                              <div>RAM</div>
                              <div class="color-highlight text-very-compact">
                                <span>{{ mul (div (.Int "mem" | toFloat) (.Int "maxmem" | toFloat)) 100 | toInt }}</span> <span class="color-base">%</span>
                              </div>
                            </div>
                            <div data-popover-type="html">
                              <div data-popover-html>
                                <div>
                                  <div class="flex">
                                    <div class="size-h5">RAM</div>
                                    <div class="value-separator"></div>
                                    <div class="color-highlight text-very-compact">
                                      <span>{{ div (.Int "mem" | toFloat) 1073741824 | toInt | formatNumber }}GB</span>
                                      <span class="color-base size-h5">/</span>
                                      <span>{{ div (.Int "maxmem" | toFloat) 1073741824 | toInt | formatNumber }}GB</span>
                                    </div>
                                  </div>
                                </div>
                              </div>
                              <div class="progress-bar progress-bar-combined">
                                <div class="progress-value{{ if ge (mul (div (.Int "mem" | toFloat) (.Int "maxmem" | toFloat)) 100 | toInt) 80 }} progress-value-notice{{ end }}" style="--percent: {{ mul (div (.Int "mem" | toFloat) (.Int "maxmem" | toFloat)) 100 | toInt }}"></div>
                              </div>
                            </div>
                          </div>
                          <div class="flex-1">
                            <div class="flex justify-between items-end size-h5">
                              <div>DISK</div>
                              <div class="color-highlight text-very-compact">
                                <span>{{ mul (div (.Int "disk" | toFloat) (.Int "maxdisk" | toFloat)) 100 | toInt }}</span> <span class="color-base">%</span>
                              </div>
                            </div>
                            <div data-popover-type="html">
                              <div data-popover-html>
                                <div>
                                  <div class="flex">
                                    <div class="size-h5">DISK</div>
                                    <div class="value-separator"></div>
                                    <div class="color-highlight text-very-compact">
                                      <span>{{ div (.Int "disk" | toFloat) 1073741824 | toInt | formatNumber }}GB</span>
                                      <span class="color-base size-h5">/</span>
                                      <span>{{ div (.Int "maxdisk" | toFloat) 1073741824 | toInt | formatNumber }}GB</span>
                                    </div>
                                  </div>
                                </div>
                              </div>
                              <div class="progress-bar progress-bar-combined">
                                <div class="progress-value{{ if ge (mul (div (.Int "disk" | toFloat) (.Int "maxdisk" | toFloat)) 100 | toInt) 80 }} progress-value-notice{{ end }}" style="--percent: {{ mul (div (.Int "disk" | toFloat) (.Int "maxdisk" | toFloat)) 100 | toInt }}"></div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </li>
                    {{ end }}
                  </ul>

              - type: custom-api
                title: Unifi
                cache: 1m
                allow-insecure: true
                url: ${UNIFI_URL}/proxy/network/api/stat/sites
                headers:
                  X-API-KEY: ${UNIFI_API_KEY}
                  Accept: application/json
                template: |
                  <style>
                    .list-horizontal-text.no-bullets-unifi > *:not(:last-child)::after {
                        content: none !important;
                    }
                    .list-horizontal-text.no-bullets-unifi > *:not(:last-child) {
                      margin-right: 1em;
                    }
                  </style>
                  {{ range .JSON.Array "data" }}
                    <div style="display:flex; align-items:center; gap:12px;">
                      <div style="width:40px; height:40px; flex-shrink:0; display:flex; justify-content:center; align-items:center; overflow:hidden;">
                        <img src="https://cdn.jsdelivr.net/gh/selfhst/icons/svg/ubiquiti-unifi-light.svg" width="24" height="24" style="object-fit:contain;">
                      </div>
                      <div style="flex-grow:1; min-width:0;">
                        <a class="size-h4 block text-truncate color-highlight">
                          {{ .String "health.#(subsystem=\"wan\").gw_name" }}
                          {{ if eq (.String "health.#(subsystem=\"wan\").status") "ok" }}
                          <span style="width: 8px; height: 8px; border-radius: 50%; background-color: var(--color-positive); display: inline-block; vertical-align: middle;" data-popover-type="text" data-popover-text="WAN Connected"></span>
                          {{ else }}
                          <span style="width: 8px; height: 8px; border-radius: 50%; background-color: var(--color-negative); display: inline-block; vertical-align: middle;" data-popover-type="text" data-popover-text="WAN Disconnected"></span>
                          {{ end }}
                        </a>
                        <ul class="list-horizontal-text no-bullets-unifi">
                          <li data-popover-type="text" data-popover-text="Uptime: {{ printf "%.1f" (div (.Float "health.#(subsystem=\"wan\").gw_system-stats.uptime") 86400) }} Days">
                            <p style="display:inline-flex;align-items:center;">
                              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 122.88 99.54" fill="currentColor" stroke="currentColor" stroke-width="0" class="size-6" style="height:1em;vertical-align:middle;margin-right:0.5em;">
                                <path d="M73.12,0c6.73,0,13.16,1.34,19.03,3.77c6.09,2.52,11.57,6.22,16.16,10.81l0,0c4.58,4.58,8.28,10.06,10.8,16.17 c2.43,5.87,3.77,12.3,3.77,19.02c0,6.73-1.34,13.16-3.77,19.03c-2.52,6.09-6.22,11.57-10.81,16.16l0,0 c-4.58,4.58-10.06,8.28-16.17,10.8c-5.87,2.43-12.3,3.77-19.02,3.77c-6.73,0-13.16-1.34-19.03-3.77 c-6.09-2.52-11.57-6.22-16.15-10.8l-0.01-0.01c-4.59-4.59-8.28-10.07-10.8-16.15c-0.78-1.89-1.45-3.83-2-5.82 c1.04,0.1,2.1,0.15,3.17,0.15c2.03,0,4.01-0.18,5.94-0.53c0.32,0.96,0.67,1.91,1.05,2.84c2.07,5,5.11,9.5,8.89,13.28 c3.78,3.78,8.29,6.82,13.28,8.89c4.81,1.99,10.1,3.1,15.66,3.1s10.84-1.1,15.66-3.1c5-2.07,9.5-5.11,13.28-8.89 c3.78-3.78,6.82-8.29,8.89-13.28c1.99-4.81,3.1-10.1,3.1-15.66s-1.1-10.84-3.1-15.66c-2.07-5-5.11-9.5-8.89-13.28 s-8.29-6.82-13.28-8.89c-4.81-1.99-10.1-3.1-15.66-3.1s-10.84,1.1-15.66,3.1c-0.43,0.18-0.86,0.37-1.28,0.56 c-1.64-2.58-3.62-4.92-5.89-6.95c1.24-0.64,2.51-1.23,3.8-1.77C59.97,1.34,66.39,0,73.12,0L73.12,0L73.12,0z M67.41,26.11 c0-1.22,0.5-2.32,1.29-3.12c0.8-0.8,1.9-1.29,3.12-1.29c1.22,0,2.32,0.49,3.12,1.29c0.8,0.8,1.29,1.9,1.29,3.12v23.22l17.35,10.29 c1.04,0.62,1.74,1.61,2.02,2.7c0.28,1.09,0.15,2.29-0.47,3.33v0.01l0,0c-0.62,1.04-1.61,1.74-2.7,2.02s-2.29,0.15-3.33-0.47h-0.01 l0,0L69.68,55.7c-0.67-0.37-1.22-0.91-1.62-1.55c-0.41-0.67-0.65-1.46-0.65-2.3V26.11L67.41,26.11L67.41,26.11z"/>
                                <path style="fill-rule:evenodd; clip-rule:evenodd;" d="M26.98,2.64c14.9,0,26.98,12.08,26.98,26.98c0,14.9-12.08,26.98-26.98,26.98S0,44.52,0,29.62 C0,14.72,12.08,2.64,26.98,2.64L26.98,2.64L26.98,2.64z M26.98,13.72l14.48,17.9h-8.99v9.52H21.49v-9.52H12.5L26.98,13.72 L26.98,13.72z"/>
                              </svg>
                              {{ printf "%.1f" (div (.Float "health.#(subsystem=\"wan\").gw_system-stats.uptime") 86400) }}
                            </p>
                          </li>
                          <li data-popover-type="text" data-popover-text="Wired clients: {{ .Int "health.#(subsystem=\"lan\").num_user" }}">
                            <p style="display:inline-flex;align-items:center;">
                              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="0" class="size-6" style="height:1em;vertical-align:middle;margin-right:0.5em;">
                                <path fill="none" d="M0 0h24v24H0z"></path><path d="M7.77 6.76 6.23 5.48.82 12l5.41 6.52 1.54-1.28L3.42 12l4.35-5.24zM7 13h2v-2H7v2zm10-2h-2v2h2v-2zm-6 2h2v-2h-2v2zm6.77-7.52-1.54 1.28L20.58 12l-4.35 5.24 1.54 1.28L23.18 12l-5.41-6.52z"></path>
                              </svg>
                              {{ .Int "health.#(subsystem=\"lan\").num_user" }}
                            </p>
                          </li>
                          <li data-popover-type="text" data-popover-text="Wireless clients: {{ .Int "health.#(subsystem=\"wlan\").num_user" }}">
                            <p style="display:inline-flex;align-items:center;">
                              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="0" class="size-6" style="height:1em;vertical-align:middle;margin-right:0.5em;">
                                <path d="M12 6c3.537 0 6.837 1.353 9.293 3.809l1.414-1.414C19.874 5.561 16.071 4 12 4c-4.071.001-7.874 1.561-10.707 4.395l1.414 1.414C5.163 7.353 8.463 6 12 6zm5.671 8.307c-3.074-3.074-8.268-3.074-11.342 0l1.414 1.414c2.307-2.307 6.207-2.307 8.514 0l1.414-1.414z"></path><path d="M20.437 11.293c-4.572-4.574-12.301-4.574-16.873 0l1.414 1.414c3.807-3.807 10.238-3.807 14.045 0l1.414-1.414z"></path><circle cx="12" cy="18" r="2"></circle>
                              </svg>
                              {{ .Int "health.#(subsystem=\"wlan\").num_user" }}
                            </p>
                          </li>
                        </ul>
                      </div>
                    </div>
                    <div class="margin-block-2" style="margin-top: 1em">
                      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <div data-popover-type="html">
                          <div data-popover-html>
                            <div>
                              {{ range .Array "health.#(subsystem=\"wan\").uptime_stats.WAN.monitors" }}
                              <div class="flex">
                                <div class="size-h5">{{ .String "target" }}</div>
                                <div class="value-separator"></div>
                                <div class="color-highlight text-very-compact"><span>{{ .Int "latency_average" }}</span> <span class="color-base size-h5">ms</span></div>
                              </div>
                              {{ end }}
                            </div>
                          </div>
                          <div class="size-h5">Latency</div>
                          <div class="size-h3 color-highlight">{{ .Int "health.#(subsystem=\"wan\").uptime_stats.WAN.latency_average" }}<span class="color-base"> ms</span></div>
                        </div>
                        <div>
                          <div class="size-h5">WAN IP</div>
                          <div class="size-h3 color-highlight">{{ .String "health.#(subsystem=\"wan\").wan_ip" }}</div>
                        </div>
                        <div>
                          <div class="flex items-end size-h5">
                            <div>Gateway CPU</div>
                            <div class="color-highlight margin-left-auto text-very-compact">
                              {{ printf "%.0f" (.Float "health.#(subsystem=\"wan\").gw_system-stats.cpu") }}<span class="color-base"> %</span>
                            </div>
                          </div>
                          <div class="progress-bar progress-bar-combined">
                            <div class="progress-value{{ if ge (.Float "health.#(subsystem=\"wan\").gw_system-stats.cpu" | toInt) 80 }} progress-value-notice{{ end }}" style="--percent: {{ .Float "health.#(subsystem=\"wan\").gw_system-stats.cpu" | toInt | formatNumber }}"></div>
                          </div>
                        </div>
                        <div class="flex-1">
                          <div class="flex items-end size-h5">
                            <div>Gateway RAM</div>
                            <div class="color-highlight margin-left-auto text-very-compact">
                              {{ printf "%.0f" (.Float "health.#(subsystem=\"wan\").gw_system-stats.mem") }}<span class="color-base">%</span>
                            </div>
                          </div>
                          <div class="progress-bar progress-bar-combined">
                            <div class="progress-value{{ if ge (.Float "health.#(subsystem=\"wan\").gw_system-stats.mem" | toInt) 80 }} progress-value-notice{{ end }}" style="--percent: {{ .Float "health.#(subsystem=\"wan\").gw_system-stats.mem" | toInt | formatNumber }}"></div>
                          </div>
                        </div>
                      </div>
                    </div>
                  {{ end }}

          - size: full
            widgets:
              - type: monitor
                title: Services
                cache: 1m
                sites:
                  - title: ArgoCD
                    url: https://argocd.home.lab
                    icon: si:argo
                    allow-insecure: true
                  - title: Grafana
                    url: https://grafana.home.lab
                    icon: si:grafana
                    allow-insecure: true
                  - title: Jellyfin
                    url: https://jellyfin.home.lab
                    icon: si:jellyfin
                    allow-insecure: true
                  - title: Linkwarden
                    url: https://linkwarden.home.lab
                    allow-insecure: true
                  - title: pgAdmin
                    url: https://pgadmin.home.lab
                    icon: si:postgresql
                    allow-insecure: true
                  - title: Workout Tracker
                    url: https://workout.home.lab
                    allow-insecure: true
                  - title: CorpoCache
                    url: https://cache.home.lab
                    allow-insecure: true
                  - title: n8n
                    url: https://n8n.home.lab
                    icon: si:n8n
                    allow-insecure: true
                  - title: Open WebUI
                    url: https://chat.home.lab
                    icon: si:openai
                    allow-insecure: true
                  - title: LiteLLM
                    url: https://llm.home.lab/ui
                    icon: si:openai
                    allow-insecure: true
                  - title: Forgejo
                    url: https://git.home.lab
                    icon: si:forgejo
                    allow-insecure: true
                  - title: Harbor Registry
                    url: https://registry.home.lab
                    icon: si:harbor
                    allow-insecure: true
                  - title: Proxmox (pve-identity)
                    url: https://pve-identity.home.lab:8006
                    icon: si:proxmox
                    allow-insecure: true
                  - title: Proxmox (pve-r720)
                    url: https://pve-r720.home.lab:8006
                    icon: si:proxmox
                    allow-insecure: true
                  - title: Proxmox (pve-desktop)
                    url: https://pve-desktop.home.lab:8006
                    icon: si:proxmox
                    allow-insecure: true
                  - title: Unifi Controller
                    url: https://cloudkey.home.lab
                    icon: si:ubiquiti
                    allow-insecure: true

              - type: custom-api
                title: Latest Movies
                frameless: true
                cache: 5m
                options:
                  base-url: http://jellyfin.home.lab
                  api-key: ${JELLYFIN_API_KEY}
                  user-name: "root"
                  library-name: "Movies"
                  mode: "latest"
                  item-count: "10"
                  small-column: false
                  show-thumbnail: false
                  thumbnail-aspect-ratio: "default"
                template: |
                  {{ $baseURL := .Options.StringOr "base-url" "" }}
                  {{ $apiKey := .Options.StringOr "api-key" "" }}
                  {{ $userName := .Options.StringOr "user-name" "" }}
                  {{ $libraryName := .Options.StringOr "library-name" "" }}
                  {{ $mode := .Options.StringOr "mode" "latest" }}
                  {{ $itemCount := .Options.StringOr "item-count" "10" }}
                  {{ $mediaTypes := .Options.StringOr "media-types" "Movie,Episode,MusicAlbum" }}
                  {{ $thumbAspectRatio := .Options.StringOr "thumbnail-aspect-ratio" "" }}
                  {{ $isSmallColumn := .Options.BoolOr "small-column" false }}
                  {{ $showThumbnail := .Options.BoolOr "show-thumbnail" false }}
                  {{ $showProgressBar := .Options.BoolOr "progress-bar" true }}

                  {{ define "errorMsg" }}
                    <div class="widget-error-header">
                      <div class="color-negative size-h3">ERROR</div>
                      <svg class="widget-error-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"></path>
                      </svg>
                    </div>
                    <p class="break-all">{{ . }}</p>
                  {{ end }}

                  {{ if or (eq $baseURL "") (eq $apiKey "") (eq $userName "") (eq $mode "") (and (eq $mode "latest") (eq $libraryName "")) }}
                    {{ template "errorMsg" "Some required options are not set." }}
                  {{ else }}
                    {{ $userID := "" }}
                    {{ $usersCall := newRequest (print $baseURL "/Users")
                        | withParameter "api_key" $apiKey
                        | withHeader "Accept" "application/json"
                        | getResponse }}
                    {{ range $i, $user := $usersCall.JSON.Array "" }}
                      {{ if eq ($user.String "Name") $userName }}
                        {{ $userID = $user.String "Id" }}
                        {{ break }}
                      {{ end }}
                    {{ end }}
                    {{ if eq $userID "" }}
                      {{ template "errorMsg" (printf "User '%s' not found." $userName) }}
                    {{ else }}
                      {{ $items := "" }}
                      {{ if eq $mode "latest" }}
                        {{ $libraryID := "" }}
                        {{ $userViewsCall := newRequest (print $baseURL "/UserViews")
                            | withParameter "api_key" $apiKey
                            | withParameter "userId" $userID
                            | withHeader "Accept" "application/json"
                            | getResponse }}
                        {{ range $i, $item := $userViewsCall.JSON.Array "Items" }}
                          {{ if eq ($item.String "Name") $libraryName }}
                            {{ $libraryID = $item.String "Id" }}
                            {{ break }}
                          {{ end }}
                        {{ end }}
                        {{ if eq $libraryID "" }}
                          {{ template "errorMsg" (printf "Library '%s' not found." $libraryName) }}
                        {{ else }}
                          {{ $latestCall := newRequest (print $baseURL "/Users/" $userID "/Items/Latest")
                              | withParameter "api_key" $apiKey
                              | withParameter "Limit" $itemCount
                              | withParameter "ParentId" $libraryID
                              | withParameter "IncludeItemTypes" $mediaTypes
                              | withParameter "GroupItems" "true"
                              | withHeader "Accept" "application/json"
                              | getResponse }}
                          {{ $items = $latestCall.JSON.Array "" }}
                        {{ end }}
                      {{ else if eq $mode "nextup" }}
                        {{ $nextUpCall := newRequest (print $baseURL "/Shows/NextUp")
                            | withParameter "api_key" $apiKey
                            | withParameter "UserId" $userID
                            | withParameter "Limit" $itemCount
                            | withParameter "EnableResumable" "true"
                            | withHeader "Accept" "application/json"
                            | getResponse }}
                        {{ $items = $nextUpCall.JSON.Array "Items" }}
                      {{ else }}
                        {{ template "errorMsg" "Unknown mode, expected 'latest' or 'nextup'" }}
                      {{ end }}

                      {{ if eq (len $items) 0 }}
                        <p>No items found, start streaming something!</p>
                      {{ else }}
                        <div class="carousel-container show-right-cutoff">
                          <div class="cards-horizontal carousel-items-container">
                            {{ range $n, $item := $items }}
                              {{ $mediaType := $item.String "Type" }}
                              {{ $title := $item.String "Name" }}
                              {{ $itemID := $item.String "Id" }}
                              {{ $seriesTitle := "" }}
                              {{ $artist := "" }}
                              {{ $seriesID := "" }}
                              {{ $season := "" }}
                              {{ $episode := "" }}
                              {{ $playPercentage := "" }}
                              {{ $unwatchedEpisodeCount := "" }}
                              {{ if eq $mediaType "Movie" }}
                              {{ else if eq $mediaType "Series" }}
                                {{ $unwatchedEpisodeCount = $item.Int "UserData.UnplayedItemCount" }}
                              {{ else if eq $mediaType "Episode" }}
                                {{ $unwatchedEpisodeCount = 1 }}
                                {{ $seriesTitle = $item.String "SeriesName" }}
                                {{ $seriesID = $item.String "SeriesId" }}
                                {{ $season = $item.Int "ParentIndexNumber" }}
                                {{ $episode = $item.Int "IndexNumber" }}
                                {{ if $item.Exists "UserData.PlayedPercentage" }}
                                  {{ $playPercentage = $item.String "UserData.PlayedPercentage" }}
                                {{ end }}
                                {{ if eq $mode "latest" }}
                                  {{ $itemID = $seriesID }}
                                  {{ $title = $seriesTitle }}
                                {{ end }}
                              {{ else if eq $mediaType "MusicAlbum" }}
                                {{ $artist = $item.String "AlbumArtist" }}
                              {{ end }}
                              {{ $linkURL := print $baseURL "/web/#/details?id=" $itemID }}
                              <a class="card widget-content-frame" href="{{ $linkURL | safeURL }}">
                                <div class="grow padding-inline-widget margin-top-10 margin-bottom-10">
                                  <ul class="flex flex-column justify-evenly margin-bottom-3 {{ if $isSmallColumn }}size-h6{{ end }}" style="height: 100%;">
                                    {{ if eq $mode "latest" }}
                                      {{ if or (eq $mediaType "Series") (eq $mediaType "Episode") }}
                                        <ul class="list-horizontal-text flex-nowrap">
                                          <li class="color-primary shrink-0">{{ $unwatchedEpisodeCount }}</li>
                                          <li class="text-truncate">{{ $title }}</li>
                                        </ul>
                                      {{ else if eq $mediaType "MusicAlbum" }}
                                        <ul class="list-horizontal-text flex-nowrap">
                                          <li class="color-primary text-truncate">{{ $artist }}</li>
                                          <li class="text-truncate">{{ $title }}</li>
                                        </ul>
                                      {{ else }}
                                        <li class="text-truncate">{{ $title }}</li>
                                      {{ end }}
                                    {{ else if eq $mode "nextup" }}
                                      <ul class="list-horizontal-text flex-nowrap">
                                        <li class="color-primary shrink-0">S{{ $season }}E{{ $episode }}</li>
                                        <li class="text-truncate">{{ $seriesTitle }}</li>
                                      </ul>
                                      <li class="text-truncate">{{ $title }}</li>
                                    {{ end }}
                                  </ul>
                                </div>
                              </a>
                            {{ end }}
                          </div>
                        </div>
                      {{ end }}
                    {{ end }}
                  {{ end }}

              - type: group
                widgets:
                  - type: extension
                    title: K8s Nodes
                    url: http://glance-k8s.home.lab/extension/nodes
                    allow-potentially-dangerous-html: true
                    cache: 30s
                  - type: extension
                    title: K8s Applications
                    url: http://glance-k8s.home.lab/extension/apps
                    allow-potentially-dangerous-html: true
                    cache: 30s
                    parameters:
                      show-if: |
                        namespace != "kube-system" and
                        ("glance/hide" not in annotations || annotations["glance/hide"] != "true")

              - type: custom-api
                title: Proxmox-VE Resources
                cache: 1m
                url: ${PROXMOXVE_URL}/api2/json/cluster/resources
                allow-insecure: true
                headers:
                  Accept: application/json
                  Authorization: PVEAPIToken=${PROXMOXVE_KEY}
                options:
                  cpu_graph: true
                  disk_graph: true
                  ram_graph: true
                template: |
                  <style>
                    .proxmox-container { font-size: 0.9em; }
                    .resource-header, .resource-row { display: flex; border-collapse: collapse; align-items: center; gap: 10px; padding: 4px 0;}
                    .resource-row { text-transform: lowercase;}
                    .resource-header { text-transform: uppercase; font-size: 1em; font-weight: bold; color: var(--color-primary); border-bottom: 1px solid var(--color-primary); margin-bottom: 1px;}
                    .col { min-width: 0; margin-right: 15px; }
                    .col-item { flex: 1.5; color: var(--color-primary);}
                    .col-type { flex: 1; }
                    .col-ram { flex: 2; }
                    .col-cpu { flex: 2; }
                    .col-disk { flex: 2; }
                    .col-status { flex: 0.5; text-align: center; }
                    .server-type { padding: 2px 6px; border-radius: 4px; text-transform: lowercase; }
                    .stat-header { display: flex; justify-content: space-between; align-items: flex-end; font-size: 0.85em;}
                    .stat-percent { font-weight: 500;}
                    .status-indicator { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-left: 4px;}
                    .indicator-positive { background-color: var(--color-positive); }
                    .indicator-negative { background-color: var(--color-negative); }
                  </style>
                  {{ if eq .Response.StatusCode 200 }}
                    <div class="proxmox-container">
                      {{- $filteredResources := .JSON.Array "data.#(type!=\"node\" and type!=\"sdn\")#" -}}
                      {{- $sortedResources := sortByString "type" "asc" $filteredResources -}}
                      {{- $bytesInGB := toFloat 1073741824 -}}
                      <div class="resource-header">
                        <div class="col col-item">ITEM</div>
                        <div class="col col-type">TYPE</div>
                        {{ if .Options.BoolOr "ram_graph" true }}<div class="col col-ram">RAM</div>{{ end }}
                        {{ if .Options.BoolOr "cpu_graph" true }}<div class="col col-cpu">CPU</div>{{ end }}
                        {{ if .Options.BoolOr "disk_graph" true }}<div class="col col-disk">DISK</div>{{ end }}
                        <div class="col col-status">STATUS</div>
                      </div>
                      {{- range $sortedResources -}}
                        {{- $type := .String "type" -}}
                        {{ if and (ne $type "node") (ne $type "sdn") }}
                          <div class="resource-row">
                            <div class="col col-item" title="{{ if .Exists "name" }}{{ .String "name" }}{{ else }}{{ .String "storage" }}{{ end }}">
                              {{ if .Exists "name" }}{{ .String "name" }}{{ else }}{{ .String "storage" }}{{ end }}
                            </div>
                            <div class="col col-type">
                              <span class="server-type">{{ $type }}</span>
                            </div>
                            {{ if $.Options.BoolOr "ram_graph" true }}
                              <div class="col col-ram">
                                {{- if and (or (eq $type "qemu") (eq $type "lxc")) (gt (.Float "maxmem") 0.0) -}}
                                  {{- $ramPct := mul (div (.Float "mem") (.Float "maxmem")) 100 | toInt -}}
                                  {{- if gt $ramPct 100 }}{{ $ramPct = 100 }}{{ end -}}
                                  <div data-popover-type="html">
                                    <div data-popover-html>Usage: {{ printf "%.1f" (div (.Float "mem") $bytesInGB) }}GB<br>Total: {{ printf "%.1f" (div (.Float "maxmem") $bytesInGB) }}GB</div>
                                    <div class="stat-header"><span class="stat-percent">{{ $ramPct }}%</span></div>
                                    <div class="progress-bar"><div class="progress-value{{ if ge $ramPct 80 }} progress-value-notice{{ end }}" style="--percent: {{ $ramPct }}"></div></div>
                                  </div>
                                {{- end -}}
                              </div>
                            {{ end }}
                            {{ if $.Options.BoolOr "cpu_graph" true }}
                              <div class="col col-cpu">
                                {{- if and (or (eq $type "qemu") (eq $type "lxc")) -}}
                                  {{- $percentCPU := mul (.Float "cpu") 100 | toInt -}}
                                  <div data-popover-type="html">
                                    <div data-popover-html>Load: {{ $percentCPU }}%<br>Cores: {{ .Int "maxcpu" }}</div>
                                    <div class="stat-header"><span class="stat-percent">{{ $percentCPU }}%</span></div>
                                    <div class="progress-bar"><div class="progress-value{{ if ge $percentCPU 80 }} progress-value-notice{{ end }}" style="--percent: {{ $percentCPU }}"></div></div>
                                  </div>
                                {{- end -}}
                              </div>
                            {{ end }}
                            {{ if $.Options.BoolOr "disk_graph" true }}
                              <div class="col col-disk">
                                {{- if and (or (eq $type "lxc") (eq $type "storage")) (gt (.Float "maxdisk") 0.0) -}}
                                  <div data-popover-type="html">
                                    <div data-popover-html>Usage: {{ printf "%.1f" (div (.Float "disk") $bytesInGB) }}GB<br>Total: {{ printf "%.1f" (div (.Float "maxdisk") $bytesInGB) }}GB</div>
                                    <div class="stat-header"><span class="stat-percent">{{ mul (div (.Float "disk") (.Float "maxdisk")) 100 | toInt }}%</span></div>
                                    <div class="progress-bar"><div class="progress-value{{ if ge (mul (div (.Float "disk") (.Float "maxdisk")) 100 | toInt) 80 }} progress-value-notice{{ end }}" style="--percent: {{ mul (div (.Float "disk") (.Float "maxdisk")) 100 | toInt }}"></div></div>
                                  </div>
                                {{- end -}}
                              </div>
                            {{ end }}
                            <div class="col col-status">
                              {{- $status := .String "status" -}}
                              <span class="status-indicator {{ if or (eq $status "running") (eq $status "available") (eq $status "ok") (eq $status "online")}}indicator-positive{{ else }}indicator-negative{{ end }}"
                                    data-popover-type="text" data-popover-text="{{ $status }}">
                              </span>
                            </div>
                          </div>
                        {{ end }}
                      {{- end -}}
                    </div>
                  {{ else }}
                    <p>Failed: {{ .Response.Status }}</p>
                  {{ end }}

          - size: small
            widgets:
              - type: custom-api
                title: Weather Forecast
                cache: 1h
                options:
                  location: charlotte
                  temp_unit: "fahrenheit"
                  color_clear: "#FFA500"
                  color_partly: "#EBE387"
                  color_cloud: "#A9A9A9"
                  color_smog: "#D3D3D3"
                  color_drizzle: "#5F9EA0"
                  color_rain: "#4682B4"
                  color_freezing_rain: "#B0E0E6"
                  color_snow: "#FFFFFF"
                  color_thunderstorm: "#696969"
                  color_other: "#FFFFFF"
                  color_red: "#F08C46"
                  color_yellow: "#F0F046"
                  color_blue: "#46F0F0"
                  color_white: "#FFFFFF"
                template: |
                  {{ $temp_unit := .Options.StringOr "temp_unit" "celsius" }}
                  {{ $weekend_color := .Options.StringOr "weekend_color" "var(--color-separator)" }}
                  {{ $overlay_color := .Options.StringOr "overlay_color" "hsl(var(--bghs), var(--bgl), 50%)" }}
                  {{ $color_clear := .Options.StringOr "color_clear" "var(--color-text-highlight)" }}
                  {{ $color_partly := .Options.StringOr "color_partly" "var(--color-text-highlight)" }}
                  {{ $color_cloud := .Options.StringOr "color_cloud" "var(--color-text-highlight)" }}
                  {{ $color_smog := .Options.StringOr "color_smog" "var(--color-text-highlight)" }}
                  {{ $color_drizzle := .Options.StringOr "color_drizzle" "var(--color-text-highlight)" }}
                  {{ $color_rain := .Options.StringOr "color_rain" "var(--color-text-highlight)" }}
                  {{ $color_freezing_rain := .Options.StringOr "color_freezing_rain" "var(--color-text-highlight)" }}
                  {{ $color_snow := .Options.StringOr "color_snow" "var(--color-text-highlight)" }}
                  {{ $color_thunderstorm := .Options.StringOr "color_thunderstorm" "var(--color-text-highlight)" }}
                  {{ $color_other := .Options.StringOr "color_other" "var(--color-text-highlight)" }}
                  {{ $color_red := .Options.StringOr "color_red" "var(--color-negative)" }}
                  {{ $color_yellow := .Options.StringOr "color_yellow" "var(--color-text-subdue)" }}
                  {{ $color_blue := .Options.StringOr "color_blue" "var(--color-positive)" }}
                  {{ $color_white := .Options.StringOr "color_white" "var(--color-text-highlight)" }}
                  {{ $temp_red := .Options.FloatOr "temp_red" 27 }}
                  {{ $temp_yellow := .Options.FloatOr "temp_yellow" 20 }}
                  {{ $temp_blue := .Options.FloatOr "temp_blue" 10.0 }}
                  {{ $temp_white := .Options.FloatOr "temp_white" 0 }}
                  {{ if eq $temp_unit "fahrenheit" }}
                    {{ $temp_red = .Options.FloatOr "temp_red" 80.0 }}
                    {{ $temp_yellow = .Options.FloatOr "temp_yellow" 70.0 }}
                    {{ $temp_blue = .Options.FloatOr "temp_blue" 50.0 }}
                    {{ $temp_white = .Options.FloatOr "temp_white" 30.0 }}
                  {{ end }}
                  {{ $location_string := replaceAll " " "%20" (.Options.StringOr "location" "") }}
                  {{ $url1 := printf "https://geocoding-api.open-meteo.com/v1/search?name=%s&count=20&language=en&format=json" $location_string }}
                  {{ $req1 := newRequest $url1 | getResponse }}
                  {{ $latitude := $req1.JSON.String "results.0.latitude" }}
                  {{ $longitude := $req1.JSON.String "results.0.longitude" }}
                  {{ $url2 := printf "https://api.open-meteo.com/v1/forecast?latitude=%s&longitude=%s&temperature_unit=%s&daily=temperature_2m_max,temperature_2m_min,weather_code&timezone=America/New_York" $latitude $longitude $temp_unit }}
                  {{ $req2 := newRequest $url2 | getResponse }}
                  <div style="display: flex; justify-content: center; align-items: center; flex-direction: column;">
                    {{ $dates := $req2.JSON.Array "daily.time" }}
                    <div style="position: relative; width: 100%; height: 25px;">
                      {{ range $index, $date := $dates }}
                        {{ $dateString := .String "" }}
                        {{ $parsedDate := $dateString | parseTime "DateOnly" }}
                        {{ $dayOfWeek := $parsedDate.Format "Monday" | trimSuffix "day" | trimSuffix "on" | trimSuffix "es" | trimSuffix "edn" | trimSuffix "urs" | trimSuffix "ri" | trimSuffix "tur" | trimSuffix "n" }}
                        {{ $day_color := "" }}
                        {{ if eq $dayOfWeek "Sa" "Su" }}
                          {{ $day_color = $weekend_color }}
                        {{ end }}
                        <div style="text-align: center; width: 10%; height: 25px; line-height: 25px; margin: 0 10% 0 3%; left: {{ mul $index 14 }}%; position: absolute; background-color: {{ $day_color | safeCSS }}">
                          <p class="size-h4 color-paragraph">{{ $dayOfWeek }}</p>
                        </div>
                      {{ end }}
                    </div>
                    <div style="position: relative; width: 100%; height: 25px;">
                      {{ range $index, $date := $dates }}
                        {{ $dateString := .String "" }}
                        {{ $trimmedDate := replaceMatches "[0-9]+-[0-9]+-" "" $dateString }}
                        <div style="text-align: center; width: 10%; height: 25px; line-height: 25px; margin: 0 10% 0 3%; left: {{ mul $index 14 }}%; position: absolute;">
                          <p class="size-h4 color-paragraph">{{ $trimmedDate }}</p>
                        </div>
                      {{ end }}
                    </div>
                    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
                    {{ $codes := $req2.JSON.Array "daily.weather_code" }}
                    <div style="position: relative; width: 100%; height: 30px;">
                      {{ range $index, $thiscode := $codes }}
                        {{ $code := .Int "" }}
                        <div style="text-align: center; width: 10%; height: 25px; line-height: 25px; margin: 0 10% 0 3%; left: {{ mul $index 14 }}%; position: absolute;">
                        {{ $wtype := "" }}
                        {{ $wicon := "" }}
                        {{ $wcolor := "" }}
                        {{ if eq $code 0 }}
                          {{ $wtype = "Clear" }}
                          {{ $wicon = "fas fa-sun" }}
                          {{ $wcolor = $color_clear }}
                        {{ else if eq $code 1 2 }}
                          {{ $wtype = "Part Clear" }}
                          {{ $wicon = "fas fa-cloud-sun" }}
                          {{ $wcolor = $color_partly }}
                        {{ else if eq $code 3 }}
                          {{ $wtype = "Cloudy" }}
                          {{ $wicon = "fas fa-cloud" }}
                          {{ $wcolor = $color_cloud }}
                        {{ else if eq $code 45 48 }}
                          {{ $wtype = "Fog" }}
                          {{ $wicon = "fas fa-smog" }}
                          {{ $wcolor = $color_smog }}
                        {{ else if eq $code 51 53 55 56 57 }}
                          {{ $wtype = "Drizzle" }}
                          {{ $wicon = "fas fa-cloud-rain" }}
                          {{ $wcolor = $color_drizzle }}
                        {{ else if eq $code 61 63 65 80 81 82 }}
                          {{ $wtype = "Rain" }}
                          {{ $wicon = "fas fa-cloud-showers-heavy" }}
                          {{ $wcolor = $color_rain }}
                        {{ else if eq $code 66 67 }}
                          {{ $wtype = "Freezing Rain" }}
                          {{ $wicon = "fas fa-snowflake" }}
                          {{ $wcolor = $color_freezing_rain }}
                        {{ else if eq $code 71 73 75 77 85 86 }}
                          {{ $wtype = "Snow" }}
                          {{ $wicon = "fas fa-snowman" }}
                          {{ $wcolor = $color_snow }}
                        {{ else if eq $code 95 96 99 }}
                          {{ $wtype = "Thunderstorm" }}
                          {{ $wicon = "fas fa-bolt" }}
                          {{ $wcolor = $color_thunderstorm }}
                        {{ else }}
                          {{ $wtype = "Other" }}
                          {{ $wicon = "fa-solid fa-question" }}
                          {{ $wcolor = $color_other }}
                        {{ end }}
                        <i class={{ $wicon }} style="font-size: 20px; color: {{ $wcolor | safeCSS }};" title={{ $wtype }}></i>
                        </div>
                      {{ end }}
                    </div>
                  </div>
                  {{ $maxTemps := $req2.JSON.Array "daily.temperature_2m_max" }}
                  {{ $minTemps := $req2.JSON.Array "daily.temperature_2m_min" }}
                  <div style="display: flex; justify-content: flex-start; align-items: center;">
                    {{ $max_max := 0 }}
                    {{ range $maxTemps }}
                      {{ if gt (.Int "") $max_max }}
                        {{ $max_max = (.Int "") }}
                      {{ end }}
                    {{ end }}
                    {{ $min_min := 999 }}
                    {{ range $minTemps }}
                      {{ if lt (.Int "") $min_min }}
                        {{ $min_min = (.Int "") }}
                      {{ end }}
                    {{ end }}
                    {{ $max_max = add $max_max 1 }}
                    {{ $min_min = sub $min_min 1 }}
                    <div style="position: relative; width: 100%; height: 75px;">
                      {{ $temp_range := sub $max_max $min_min }}
                      {{ range $index, $thisHigh := $maxTemps }}
                        {{ $thisLow := index $minTemps $index }}
                        {{ $thisHigh = $thisHigh.Float "" }}
                        {{ $thisLow = $thisLow.Float "" }}
                        {{ $thisHighPct := sub 1 (div (sub $max_max $thisHigh) $temp_range) }}
                        {{ $thisLowPct := div (sub $thisLow $min_min) $temp_range }}
                        {{ $thisTempRange := sub $thisHigh $thisLow }}
                        {{ $red_pos := mul 100 (div (sub $thisHigh $temp_red) $thisTempRange) | toInt }}
                        {{ $yel_pos := mul 100 (div (sub $thisHigh $temp_yellow) $thisTempRange) | toInt }}
                        {{ $blu_pos := mul 100 (div (sub $thisHigh $temp_blue) $thisTempRange) | toInt }}
                        {{ $whi_pos := mul 100 (div (sub $thisHigh $temp_white) $thisTempRange) | toInt }}
                        {{ $gradient_string := printf "%s %d%%, %s %d%%, %s %d%%, %s %d%%" $color_red $red_pos $color_yellow $yel_pos $color_blue $blu_pos $color_white $whi_pos }}
                        <div style="left: {{ mul $index 14 | add 3 }}%; bottom: {{ mul $thisLowPct 100 | toInt }}%; height: {{ mul (sub $thisHighPct $thisLowPct) 100 | toInt }}%; position: absolute; background:linear-gradient({{ $gradient_string | safeCSS }}); width: 10%; text-align: center; border-radius: 10px;">
                          {{ $top_pos := -2 }}
                          {{ $bot_pos := -2 }}
                          {{ $pos_thresh := 0.20 }}
                          {{ if lt (div $thisTempRange $temp_range) $pos_thresh }}
                            {{ $top_pos = -17 }}
                            {{ $bot_pos = -19 }}
                          {{ else if and (lt (div $thisTempRange $temp_range) (mul $pos_thresh 2)) (lt (sub 1 $thisHighPct) $thisLowPct) }}
                            {{ $bot_pos = -19 }}
                          {{ else if and (lt (div $thisTempRange $temp_range) (mul $pos_thresh 2)) (gt (sub 1 $thisHighPct) $thisLowPct) }}
                            {{ $top_pos = -17 }}
                          {{ end }}
                          <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: {{ $overlay_color | safeCSS }}; z-index: 1; border-radius: 10px;">
                            <p style='color: #F0F0F0; position: absolute; top: {{ $top_pos }}px; left: 0px; right: 0px'>{{ $thisHigh | toInt }}</p>
                            <p style='color: #F0F0F0; position: absolute; bottom: {{ $bot_pos }}px; left: 0px; right:0px'>{{ $thisLow | toInt }}</p>
                          </div>
                        </div>
                      {{ end }}
                    </div>
                  </div>

              - type: custom-api
                title: Jellyfin Stats
                cache: 5m
                options:
                  url: http://jellyfin.home.lab
                  key: ${JELLYFIN_API_KEY}
                template: |
                  {{ $url := .Options.StringOr "url" "" }}
                  {{ $key := .Options.StringOr "key" "" }}
                  {{- if or (eq $url "") (eq $key "") -}}
                    <p>Error: The URL or API Key was not configured in the widget options.</p>
                  {{- else -}}
                    {{- $requestUrl := printf "%s/emby/Items/Counts?api_key=%s" $url $key -}}
                    {{- $jellyfinData := newRequest $requestUrl | getResponse -}}
                    {{- if eq $jellyfinData.Response.StatusCode 200 -}}
                      <div class="flex flex-column gap-5">
                        <div class="flex justify-between text-center">
                          <div>
                            <div class="color-highlight size-h3">{{ $jellyfinData.JSON.Int "MovieCount" | formatNumber }}</div>
                            <div class="size-h5 uppercase">Movies</div>
                          </div>
                          <div>
                            <div class="color-highlight size-h3">{{ $jellyfinData.JSON.Int "SeriesCount" | formatNumber }}</div>
                            <div class="size-h5 uppercase">TV Shows</div>
                          </div>
                          <div>
                            <div class="color-highlight size-h3">{{ $jellyfinData.JSON.Int "EpisodeCount" | formatNumber }}</div>
                            <div class="size-h5 uppercase">Episodes</div>
                          </div>
                          <div>
                            <div class="color-highlight size-h3">{{ $jellyfinData.JSON.Int "SongCount" | formatNumber }}</div>
                            <div class="size-h5 uppercase">Songs</div>
                          </div>
                        </div>
                      </div>
                    {{- else -}}
                      <p>Failed: {{ $jellyfinData.Response.Status }}</p>
                    {{- end -}}
                  {{- end -}}

              - type: custom-api
                title: GitHub Repositories
                url: https://api.github.com/user/repos
                cache: 30m
                parameters:
                  affiliation: owner
                  sort: updated
                  visibility: all
                headers:
                  Authorization: Bearer ${GITHUB_TOKEN}
                  Accept: application/vnd.github.v3+json
                  User-Agent: Glance-Dashboard
                template: |
                  <div class="github-repos">
                    <ul class="list list-gap-14 collapsible-container" data-collapse-after="5">
                      {{ range .JSON.Array "" }}
                        <li>
                          <a class="size-h3 color-primary" href="{{ .String "html_url" }}">{{ .String "full_name" }}</a>
                          <p>{{ .String "description" }}</p>
                          <ul class="list-horizontal-text device-info">
                            <li data-popover-type="html"><div data-popover-html="">Last Update</div>{{ formatTime "DateOnly" ( parseTime "RFC3339" (.String "updated_at") ) }}</li>
                            <li data-popover-type="html"><div data-popover-html="">Visibility</div>{{ .String "visibility" }}</li>
                            <li data-popover-type="html"><div data-popover-html="">Stars</div>{{ .Int "stargazers_count" }}</li>
                            {{ if .String "language" }}
                            <li data-popover-type="html"><div data-popover-html="">Language</div>{{ .String "language" }}</li>
                            {{ end }}
                          </ul>
                        </li>
                      {{ end }}
                    </ul>
                  </div>

              - type: custom-api
                title: Internet Speed
                title-url: ${SPEEDTEST_URL}
                cache: 1h
                url: ${SPEEDTEST_URL}/api/v1/results/latest
                headers:
                  Authorization: Bearer ${SPEEDTEST_TRACKER_API_TOKEN}
                  Accept: application/json
                subrequests:
                  stats:
                    url: ${SPEEDTEST_URL}/api/v1/stats
                    headers:
                      Authorization: Bearer ${SPEEDTEST_TRACKER_API_TOKEN}
                      Accept: application/json
                options:
                  showPercentageDiff: true
                template: |
                  {{ $showPercentage := .Options.BoolOr "showPercentageDiff" true }}
                  {{ $stats := .Subrequest "stats" }}
                  <div class="flex justify-between text-center margin-block-3">
                    <div>
                      {{ $downloadChange := percentChange ($stats.JSON.Float "data.download.avg_bits") (.JSON.Float "data.download_bits") }}
                      {{ if $showPercentage }}
                      <div class="size-small {{ if gt $downloadChange 0.0 }}color-positive{{ else if lt $downloadChange 0.0 }}color-negative{{ else }}color-primary{{ end }}" style="display: inline-flex; align-items: center;">
                        {{ $downloadChange | printf "%+.1f%%" }}
                      </div>
                      {{ end }}
                      <div class="color-highlight size-h3">{{ .JSON.Float "data.download_bits" | mul 0.000001 | printf "%.1f" }}</div>
                      <div class="size-h6">DOWNLOAD</div>
                    </div>
                    <div>
                      {{ $uploadChange := percentChange ($stats.JSON.Float "data.upload.avg_bits") (.JSON.Float "data.upload_bits") }}
                      {{ if $showPercentage }}
                      <div class="size-small {{ if gt $uploadChange 0.0 }}color-positive{{ else if lt $uploadChange 0.0 }}color-negative{{ else }}color-primary{{ end }}" style="display: inline-flex; align-items: center;">
                        {{ $uploadChange | printf "%+.1f%%" }}
                      </div>
                      {{ end }}
                      <div class="color-highlight size-h3">{{ .JSON.Float "data.upload_bits" | mul 0.000001 | printf "%.1f" }}</div>
                      <div class="size-h6">UPLOAD</div>
                    </div>
                    <div>
                      {{ $pingChange := percentChange ($stats.JSON.Float "data.ping.avg") (.JSON.Float "data.ping") }}
                      {{ if $showPercentage }}
                      <div class="size-small {{ if gt $pingChange 0.0 }}color-negative{{ else if lt $pingChange 0.0 }}color-positive{{ else }}color-primary{{ end }}" style="display: inline-flex; align-items: center;">
                        {{ $pingChange | printf "%+.1f%%" }}
                      </div>
                      {{ end }}
                      <div class="color-highlight size-h3">{{ .JSON.Float "data.ping" | printf "%.0f ms" }}</div>
                      <div class="size-h6">PING</div>
                    </div>
                  </div>

      - name: Startpage
        width: slim
        center-vertically: true
        columns:
          - size: full
            widgets:
              - type: search
                autofocus: true

              - type: bookmarks
                groups:
                  - title: General
                    links:
                      - title: Gmail
                        url: https://mail.google.com/mail/u/0/
                      - title: Amazon
                        url: https://www.amazon.com/
                      - title: Github
                        url: https://github.com/
                  - title: Entertainment
                    links:
                      - title: YouTube
                        url: https://www.youtube.com/
                      - title: Prime Video
                        url: https://www.primevideo.com/
                      - title: Disney+
                        url: https://www.disneyplus.com/
                  - title: Social
                    links:
                      - title: Reddit
                        url: https://www.reddit.com/
                      - title: Twitter
                        url: https://twitter.com/
                      - title: Instagram
                        url: https://www.instagram.com/

              - type: custom-api
                title: Linkwarden Bookmarks
                title-url: https://linkwarden.home.lab
                cache: 5m
                url: http://linkwarden.home.lab/api/v1/links
                headers:
                  Authorization: Bearer ${LINKWARDEN_API_KEY}
                  Accept: application/json
                parameters:
                  sort: 0
                template: |
                  {{ if eq .Response.StatusCode 200 }}
                    <ul class="list list-gap-10 collapsible-container" data-collapse-after="5">
                      {{ range .JSON.Array "response" }}
                        <li>
                          <a class="size-h4 color-highlight block text-truncate" href="{{ .String "url" }}" target="_blank" rel="noreferrer">
                            {{ if .String "name" }}{{ .String "name" }}{{ else }}{{ .String "url" }}{{ end }}
                          </a>
                          <ul class="list-horizontal-text">
                            {{ if .Exists "collection.name" }}
                              <li class="color-primary">{{ .String "collection.name" }}</li>
                            {{ end }}
                            {{ range .Array "tags" }}
                              <li>#{{ .String "name" }}</li>
                            {{ end }}
                            <li>{{ formatTime "DateOnly" (parseTime "RFC3339" (.String "createdAt")) }}</li>
                          </ul>
                        </li>
                      {{ end }}
                    </ul>
                  {{ else }}
                    <p class="color-negative">Failed to load bookmarks.</p>
                  {{ end }}

      - name: Markets
        columns:
          - size: small
            widgets:
              - type: markets
                title: Indices
                markets:
                  - symbol: SPY
                    name: S&P 500
                  - symbol: DX-Y.NYB
                    name: Dollar Index

              - type: markets
                title: Crypto
                markets:
                  - symbol: BTC-USD
                    name: Bitcoin
                  - symbol: ETH-USD
                    name: Ethereum

              - type: markets
                title: Stocks
                sort-by: absolute-change
                markets:
                  - symbol: NVDA
                    name: NVIDIA
                  - symbol: AAPL
                    name: Apple
                  - symbol: MSFT
                    name: Microsoft
                  - symbol: GOOGL
                    name: Google
                  - symbol: AMD
                    name: AMD
                  - symbol: RDDT
                    name: Reddit
                  - symbol: AMZN
                    name: Amazon
                  - symbol: TSLA
                    name: Tesla
                  - symbol: INTC
                    name: Intel
                  - symbol: META
                    name: Meta

          - size: full
            widgets:
              - type: rss
                title: News
                style: horizontal-cards
                feeds:
                  - url: https://feeds.bloomberg.com/markets/news.rss
                    title: Bloomberg
                  - url: https://moxie.foxbusiness.com/google-publisher/markets.xml
                    title: Fox Business
                  - url: https://moxie.foxbusiness.com/google-publisher/technology.xml
                    title: Fox Business

              - type: group
                widgets:
                  - type: reddit
                    show-thumbnails: true
                    subreddit: technology
                  - type: reddit
                    show-thumbnails: true
                    subreddit: wallstreetbets

              - type: videos
                style: grid-cards
                collapse-after-rows: 3
                channels:
                  - UCvSXMi2LebwJEM1s4bz5IBA
                  - UCAzhpt9DmG6PnHXjmJTvRGQ
                  - UCV6KDgJskWaEckne5aPA0aQ

          - size: small
            widgets:
              - type: rss
                title: News
                limit: 30
                collapse-after: 13
                feeds:
                  - url: https://www.ft.com/technology?format=rss
                    title: Financial Times
                  - url: https://feeds.a.dj.com/rss/RSSMarketsMain.xml
                    title: Wall Street Journal

      - name: Gaming
        columns:
          - size: small
            widgets:
              - type: twitch-top-games
                limit: 20
                collapse-after: 13
                exclude:
                  - just-chatting
                  - pools-hot-tubs-and-beaches
                  - music
                  - art
                  - asmr

              - type: custom-api
                title: Steam Specials
                cache: 12h
                url: https://store.steampowered.com/api/featuredcategories?cc=us
                template: |
                  <ul class="list list-gap-10 collapsible-container" data-collapse-after="5">
                    {{ range .JSON.Array "specials.items" }}
                      {{ $header := .String "header_image" }}
                      {{ $urlPrefix := "https://store.steampowered.com/sub/" }}
                      {{ if findMatch "/steam/apps/" $header }}
                        {{ $urlPrefix = "https://store.steampowered.com/app/" }}
                      {{ end }}
                      <li>
                        <a class="size-h4 color-highlight block text-truncate" href="{{ $urlPrefix }}{{ .Int "id" }}/">{{ .String "name" }}</a>
                        <ul class="list-horizontal-text">
                          <li>{{ .Int "final_price" | toFloat | mul 0.01 | printf "$%.2f" }}</li>
                          {{ $discount := .Int "discount_percent" }}
                          <li{{ if ge $discount 40 }} class="color-positive"{{ end }}>{{ $discount }}% off</li>
                        </ul>
                      </li>
                    {{ end }}
                  </ul>

          - size: full
            widgets:
              - type: custom-api
                title: Epic Free Games
                cache: 1h
                url: https://store-site-backend-static.ak.epicgames.com/freeGamesPromotions?locale=en&country=US&allowCountries=US
                template: |
                  <div>
                    {{ if eq .Response.StatusCode 200 }}
                      <div class="horizontal-cards-2">
                        {{ range .JSON.Array "data.Catalog.searchStore.elements" }}
                          {{ $price := .String "price.totalPrice.discountPrice" }}
                          {{ $hasPromo := gt (len (.Array "promotions.promotionalOffers")) 0 }}
                          {{ if and $hasPromo (eq $price "0") }}
                            {{ $gamePage := .String "productSlug" }}
                            {{ if gt (len (.Array "offerMappings")) 0 }}
                              {{ $gamePage = .String "offerMappings.0.pageSlug" }}
                            {{ end }}
                            <a href="https://store.epicgames.com/en-US/p/{{ $gamePage }}" target="_blank" class="card">
                              {{ $title := .String "title" }}
                              {{ range .Array "keyImages" }}
                                {{ if eq (.String "type") "OfferImageWide" }}
                                  <img src="{{ .String "url" }}" alt="{{ $title }}" style="width: 100%; max-width: 300px; height: 150px; object-fit: cover; border-radius: var(--border-radius);">
                                {{ end }}
                              {{ end }}
                              <div class="card-content">
                                <span class="size-base color-primary">{{ $title }}</span><br>
                                <span class="size-h5 color-subdue">
                                  {{ if $hasPromo }}
                                    {{ $promotions := .Array "promotions.promotionalOffers" }}
                                    {{ if gt (len $promotions) 0 }}
                                      {{ $firstPromo := index $promotions 0 }}
                                      {{ $offers := $firstPromo.Array "promotionalOffers" }}
                                      {{ if gt (len $offers) 0 }}
                                        {{ $firstOffer := index $offers 0 }}
                                        Free until {{ slice ($firstOffer.String "endDate") 0 10 }}
                                      {{ else }}
                                        Free this week!
                                      {{ end }}
                                    {{ else }}
                                      Free this week!
                                    {{ end }}
                                  {{ end }}
                                </span>
                              </div>
                            </a>
                          {{ end }}
                        {{ end }}
                      </div>
                    {{ else }}
                      <p class="color-negative">Error fetching Epic Games data.</p>
                    {{ end }}
                  </div>

              - type: group
                widgets:
                  - type: reddit
                    show-thumbnails: true
                    subreddit: pcgaming
                  - type: reddit
                    subreddit: games

              - type: videos
                style: grid-cards
                collapse-after-rows: 3
                channels:
                  - UCNvzD7Z-g64bPXxGzaQaa4g
                  - UCZ7AeeVbyslLM_8-nVy2B8Q
                  - UCHDxYLv8iovIbhrfl16CNyg
                  - UC9PBzalIcEQCsiIkq36PyUA

          - size: small
            widgets:
              - type: custom-api
                title: Steam Top Sellers
                cache: 12h
                url: https://store.steampowered.com/api/featuredcategories?cc=us
                template: |
                  <ul class="list list-gap-10 collapsible-container" data-collapse-after="10">
                    {{ range .JSON.Array "top_sellers.items" }}
                      {{ if ne (.String "name") "Steam Deck" }}
                      <li style="display: flex; align-items: center; gap: 1rem;">
                        <img src="{{ .String "small_capsule_image" }}" alt="{{ .String "name" }}" style="width: 120px; height: auto; border-radius: 4px; flex-shrink: 0;">
                        <div style="min-width: 0;">
                          <a class="size-h4 color-highlight text-truncate" style="display: block;" href="https://store.steampowered.com/app/{{ .Int "id" }}/">
                            {{ .String "name" }}
                          </a>
                          <ul class="list-horizontal-text">
                            <li>{{ div (.Int "final_price" | toFloat) 100 | printf "$%.2f" }}</li>
                            {{ $discount := .Int "discount_percent" }}
                            {{ if gt $discount 0 }}
                            <li{{ if ge $discount 40 }} class="color-positive"{{ end }}>{{ $discount }}% off</li>
                            {{ end }}
                          </ul>
                        </div>
                      </li>
                      {{ end }}
                    {{ end }}
                  </ul>

              - type: reddit
                subreddit: gamingnews
                limit: 7
                style: vertical-cards
